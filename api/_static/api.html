<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>apish</title>
    <meta name="mobile-web-app-capable" content="yes">
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>
  </head>
  <style>
  body {
    padding-top: 5em;
    background: #3e464c;
    font-family: "Roboto Condensed", "Helvetica Neue", Helvetica, Arial, sans-serif;
  }
  .ui {
    text-align: center;
    color: #4dd0e1;
    -webkit-transition: color 0.9s, -webkit-transform 1s;
    transition: color 0.9s, transform 1s;
    -webkit-transform: rotate(-5deg);
    transform: rotate(-5deg);
  }
  .animate {
    color: #ffb74d;
    -webkit-transform: rotate(5deg);
    transform: rotate(5deg);
  }
  .date {
    font-size: 4em;
   }
  .human_date {
    padding-top: 1em;
    font-size: 2em;
  }
  </style>
  <body>

    <div id='ui-json' class='ui'>
    </div>

    <script id='tpl-json' type='text/ractive'>
       <div id='date' class='date'>
          {{date}}
        </div>
       <div class='human_date'>
          {{human_date}}
        </div>
    </script>

    <script src='http://cdn.ractivejs.org/latest/ractive.min.js'></script>
    <script>
    function microAjax(B,A){this.bindFunction=function(E,D){return function(){return E.apply(D,[D])}};this.stateChange=function(D){if(this.request.readyState==4){this.callbackFunction(this.request.responseText)}};this.getRequest=function(){if(window.ActiveXObject){return new ActiveXObject("Microsoft.XMLHTTP")}else{if(window.XMLHttpRequest){return new XMLHttpRequest()}}return false};this.postBody=(arguments[2]||"");this.callbackFunction=A;this.url=B;this.request=this.getRequest();if(this.request){var C=this.request;C.onreadystatechange=this.bindFunction(this.stateChange,this);if(this.postBody!==""){C.open("POST",B,true);C.setRequestHeader("X-Requested-With","XMLHttpRequest");C.setRequestHeader("Content-type","application/x-www-form-urlencoded");C.setRequestHeader("Connection","close")}else{C.open("GET",B,true)}C.send(this.postBody)}};
      var urlArr = window.location.href.split("/");
      var apiUrl = urlArr[0] + "//" + urlArr[2];

      function get(path, el, tpl) {
        microAjax(apiUrl + path, function(data) {
          var ractive = new Ractive({el: el, template: tpl, data: JSON.parse(data)});
        });
      };
    </script>
    
    <script>
      function date() { get('/api/time/date', '#ui-json', '#tpl-json'); }
      date();
      var animate = true;
      setInterval(function(){ 
        date();

        var dateEl = document.getElementById('ui-json');

        if (animate) {
          dateEl.className = dateEl.className + " animate";
        } else {
          dateEl.className = dateEl.className.replace(" animate", "");
        }
        animate = !animate;

      }, 1000);
    </script>
    
  </body>
</html>
